# Claude Code Session Guidelines

## Debug Checkpoint Strategy

When making code changes, **ALWAYS**:

### 1. Add Strategic Debug Checkpoints
- Add console.log/print statements at critical points:
  - **Entry points** - Function start with input parameters
  - **Decision points** - Before if/else branches
  - **Data transformations** - Before and after value conversions
  - **Exit points** - Function return with output values
  - **Error boundaries** - Catch blocks and validation failures

### 2. Verify Debug Output
After making changes:
- Read the relevant code sections to verify debug statements are in place
- Check existing logs/output to see if similar checkpoints already exist
- Ensure debug messages are descriptive and include relevant variable values

### 3. Debug Message Format
Use consistent, searchable formats:
```javascript
// JavaScript/Browser
console.log('ðŸ” [CHECKPOINT:FunctionName] Description:', variable);
console.log('âœ… [CHECKPOINT:FunctionName:Success] Result:', result);
console.log('âŒ [CHECKPOINT:FunctionName:Error] Error:', error);
```

```python
# Python/Backend
print(f"ðŸ” [CHECKPOINT:function_name] Description: {variable}")
print(f"âœ… [CHECKPOINT:function_name:Success] Result: {result}")
print(f"âŒ [CHECKPOINT:function_name:Error] Error: {error}")
```

### 4. Checkpoint Locations for This Project

**browser-extension/content.js:**
- `extractFieldInfo()` - Entry, ID generation, Exit
- `detectButtonFields()` - Container detection, Button finding, Field creation
- `scanFormFields()` - Start, Field processing, Button field merging

**browser-extension/popup.js:**
- Fill script injection - Field lookup, Type detection, Fill execution
- Each field type handler - Entry, Matching logic, Event triggers, Success/Failure

**server.py:**
- `map_form_fields()` - API call entry/exit, LLM response
- `resolve_profile_values()` - Profile path resolution, Boolean conversion
- `/api/match-fields` endpoint - Request received, Processing stages, Response sent

### 5. Before Marking Work Complete
- Grep for the checkpoint markers in changed files
- Verify at least 3 checkpoints per significant function
- If debugging an issue, add checkpoints that would have caught it

### 6. When User Reports Issues
- Check if existing checkpoints captured the issue
- If not, add missing checkpoints retroactively
- Ask user to check specific checkpoint messages

## Working Principle
**Debug checkpoints are not technical debt - they are production features that enable rapid diagnosis.**

## Examples

### Good Checkpoint Coverage
```javascript
function fillButtonGroup(element, value, fieldId) {
  console.log('ðŸ” [CHECKPOINT:fillButtonGroup:Entry]', { fieldId, value, buttonCount: element.querySelectorAll('button').length });

  const buttons = element.querySelectorAll('button:not([type="submit"])');
  console.log('ðŸ” [CHECKPOINT:fillButtonGroup:ButtonsFound]', Array.from(buttons).map(b => b.textContent.trim()));

  let matchedButton = findExactMatch(buttons, value);
  if (!matchedButton) {
    console.log('ðŸ” [CHECKPOINT:fillButtonGroup:ExactMatchFailed] Trying fuzzy match');
    matchedButton = findFuzzyMatch(buttons, value);
  }

  if (matchedButton) {
    console.log('âœ… [CHECKPOINT:fillButtonGroup:Success]', { matched: matchedButton.textContent.trim() });
    matchedButton.click();
    return true;
  } else {
    console.log('âŒ [CHECKPOINT:fillButtonGroup:NoMatch]', { available: Array.from(buttons).map(b => b.textContent.trim()) });
    return false;
  }
}
```

### Poor Checkpoint Coverage
```javascript
function fillButtonGroup(element, value) {
  // No entry checkpoint - can't see what inputs were received

  const buttons = element.querySelectorAll('button');
  let matchedButton = findMatch(buttons, value);

  if (matchedButton) {
    matchedButton.click();
    return true;
  }
  // No failure checkpoint - can't see why match failed
  return false;
}
```

---

## Current Implementation Status

âœ… **Checkpoints have been added to:**
- `browser-extension/content.js`
  - extractFieldInfo() - ID generation for regular fields
  - detectButtonFields() - ID generation for button groups
- `browser-extension/popup.js`
  - fillForm() - Element lookup and type detection
  - Button group filling logic
  - Combobox filling logic

ðŸ“‹ **See DEBUG_CHECKPOINTS.md for:**
- Complete list of checkpoints
- How to interpret console output
- Common debugging patterns
- Testing checklist

---

**This is a living document. Update as we discover better debugging patterns.**
